<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Welcome!{% endblock %}</title>
    <link rel="stylesheet" href="{{ asset('dist/css/grapes.min.css') }}">
    <script src="{{ asset('dist/grapes.min.js') }}"></script>
    <script src="{{ asset('https://unpkg.com/axios/dist/axios.min.js') }}"></script>
    <script src="{{ asset('assets/plugins/jquery/jquery.min.js') }}"></script>
    <script src="{{ asset('dist/grapesjs-blocks-basic.min.js') }}"></script>
    <script src="{{ asset('dist/grapesjs-plugin-forms.min.js') }}"></script>
    <script src="{{ asset('dist/grapesjs-style-bg.min.js') }}"></script>
    <script src="{{ asset('dist/grapesjs-blocks-flexbox.min.js') }}"></script>
    <script src="{{ asset('dist/grapesjs-component-countdown.min.js') }}"></script>
    <script src="{{ asset('dist/grapesjs-tabs.min.js') }}"></script>
    <script src="{{ asset('https://unpkg.com/grapesjs-typed') }}"></script>
   <script src="{{ asset('node_modules/ckeditor/ckeditor.js') }}"></script>
    <script src="{{ asset('dist/grapesjs-plugin-ckeditor.min.js') }}"></script>
    <style>
        body,
        html {
            height: 100%;
            margin: 0;
        }
         .panel {
             width: 90%;
             max-width: 700px;
             border-radius: 3px;
             padding: 30px 20px;
             margin: 150px auto 0px;
             background-color: #d983a6;
             box-shadow: 0px 3px 10px 0px rgba(0,0,0,0.25);
             color:rgba(255,255,255,0.75);
             font: caption;
             font-weight: 100;
         }



    </style>


</head>
<body>

<div id="gjs" style="height:0px; overflow:hidden;">

    <div class="panel">
    </div>

</div>

<script type="text/javascript">
    var editor = grapesjs.init({
        showOffsets: 1,
        noticeOnUnload: 0,
        container: '#gjs',
        height: '100%',
        fromElement: true,

        plugins: ['gjs-blocks-basic',
            'grapesjs-plugin-forms',
            'grapesjs-style-bg',
            'gjs-blocks-flexbox',
            'grapesjs-tabs',
            'grapesjs-typed',
            'gjs-component-countdown',
            'gjs-plugin-ckeditor'],
        pluginsOpts: {
            'gjs-blocks-basic': {},
            'grapesjs-plugin-forms': {},
            'grapesjs-style-bg':{},
            'gjs-blocks-flexbox':{},
            'gjs-component-countdown':{'dateInputType': "datetime-local"},
            'grapesjs-tabs':{},
            },
        styleManager : {
            sectors: [{
                name: 'General',
                open: false,
                buildProps: ['float', 'display', 'position', 'top', 'right', 'left', 'bottom']
            },{
                name: 'Flex',
                open: false,
                buildProps: ['flex-direction', 'flex-wrap', 'justify-content', 'align-items', 'align-content', 'order', 'flex-basis', 'flex-grow', 'flex-shrink', 'align-self']
            },{
                name: 'Dimension',
                open: false,
                buildProps: ['width', 'height', 'max-width', 'min-height', 'margin', 'padding'],
            },{
                name: 'Typography',
                open: false,
                buildProps: ['font-family', 'font-size', 'font-weight', 'letter-spacing', 'color', 'line-height', 'text-shadow'],
            },{
                name: 'Decorations',
                open: false,
                buildProps: ['border-radius-c', 'background-color', 'border-radius', 'border', 'box-shadow', 'background'],
            },{
                name: 'Extra',
                open: false,
                buildProps: ['transition', 'perspective', 'transform'],
            }
            ],
        },
        panels: {
        },
        commands: {

            },

    });

    var newButton = editor.Panels.addButton('options',{
        id: 'canvas-clear',
        command: 'core:canvas-clear',
        label: 'Clear',


    });
    editor.BlockManager.get('tabs').set({
        category: 'Extra',
      });
    editor.BlockManager.get('typed').set({
       category: 'Extra',
    });
    editor.Panels.removeButton('options', 'export-template');
    editor.Panels.removeButton("views", "open-layers");
    editor.Panels.getButton('views','open-sm').unset('active',true);
    editor.Panels.getButton('views','open-blocks').set('active',true);
    const categories = editor.BlockManager.getCategories();
    categories.each(category => {
        category.set('open', false).on('change:open', opened => {
            opened.get('open') && categories.each(category => {
                category !== opened && category.set('open', false)
            })
        })
    })

    categories.get('Basic').set('open',true);





    $(document).ready(function() {

        $('#saveButton').click(function () {
            $.ajax({
                url : '/userdashboard/'+ "{{ title }}" +'/CreateTemplate/Save',
                type: "POST",
                data: {
                    'html': editor.getHtml
                },
                success : function (data) {
                    console.log(data);
                },
                error   : function () {
                    console.log("ERROR");
                }
            });

                    });
    })


</script>

<button class=" btn btn-primary" id="saveButton">Save</button>

</body>

</html>
